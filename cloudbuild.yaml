steps:
  - name: "gcr.io/${PROJECT_ID}/terraform"
    args:
      [
        "-chdir=deploy/gcp/environments/${_ENV}",
        "init",
        "-backend-config=bucket=${_TFSTATE_BUCKET}",
      ]
  - name: "gcr.io/${PROJECT_ID}/terraform"
    args: ["-chdir=deploy/gcp/environments/${_ENV}", "apply", "-auto-approve"]
    env:
      - "TF_VAR_project_id=${PROJECT_ID}"
      - "TF_VAR_region=${_REGION}"
      - "TF_VAR_db_instance_tier=${_DB_INSTANCE_TIER}"
      - "TF_VAR_gke_primary_ip_cidr_range=${_GKE_PRIMARY_IP_CIDR_RANGE}"
timeout: 2700s
